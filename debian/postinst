#!/bin/sh
set -e

# postinst: run after package installation
# Ensures executable permissions, updates desktop database, and registers MIME/apps where appropriate.

PKGNAME="vst-installer"
BIN_PATH="/usr/bin/${PKGNAME}"
DESKTOP_FILE="/usr/share/applications/${PKGNAME}.desktop"

# Ensure the main binary exists and is executable
if [ -f "${BIN_PATH}" ]; then
  chmod 755 "${BIN_PATH}" || true
fi

# Ensure desktop entry permissions
if [ -f "${DESKTOP_FILE}" ]; then
  chmod 644 "${DESKTOP_FILE}" || true
fi

# Update desktop database if the system provides it (makes app appear in menus sooner)
if command -v update-desktop-database >/dev/null 2>&1; then
  update-desktop-database >/dev/null 2>&1 || true
fi

# Update MIME database if present (no MIME types included by this package, safe no-op)
if command -v update-mime-database >/dev/null 2>&1; then
  update-mime-database /usr/share/mime >/dev/null 2>&1 || true
fi

# Informational message (only for maintainer scripts; not printed to stdout normally)
# Debian policy: exit 0 on success
exit 0